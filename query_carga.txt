SELECT
	DM_PERIODO.Periodo, 
	DM_PERIODO.`Año`, 
	DM_PERIODO.Mes, 	
	DM_PERIODO.period, 
  CONCAT(CABECERA_TRANSACCIONES.branch_office_id,DM_PERIODO.`Año`,DM_PERIODO.Mes) AS clave,
	CABECERA_TRANSACCIONES.branch_office_id, 
	QRY_BRANCH_OFFICES.branch_office, 
	SUM(CABECERA_TRANSACCIONES.cash_amount) as efectivo, 
	SUM(CABECERA_TRANSACCIONES.card_amount) as tarjeta, 
	SUM(CABECERA_TRANSACCIONES.subscribers) as abonados, 
	SUM(CABECERA_TRANSACCIONES.ticket_number) as ticket_number
FROM
	CABECERA_TRANSACCIONES
	LEFT JOIN QRY_BRANCH_OFFICES
	ON CABECERA_TRANSACCIONES.branch_office_id = QRY_BRANCH_OFFICES.id
	INNER JOIN DM_PERIODO
	ON CABECERA_TRANSACCIONES.date = DM_PERIODO.Fecha
WHERE 
	DAY(CABECERA_TRANSACCIONES.date) < (DAY(CURDATE())) AND
	MONTH(CABECERA_TRANSACCIONES.date)  = ((MONTH(curdate()))) AND
	YEAR(CABECERA_TRANSACCIONES.date)  = YEAR(curdate())
GROUP BY
DM_PERIODO.Periodo, 
	DM_PERIODO.Mes, 
	DM_PERIODO.`Año`, 
	DM_PERIODO.period,  
	CABECERA_TRANSACCIONES.branch_office_id, 
	QRY_BRANCH_OFFICES.branch_office
